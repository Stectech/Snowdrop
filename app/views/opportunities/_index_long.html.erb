<li class="opportunity highlight" id="opportunity_<%=opportunity.id%>">
  <% if opportunity.stage%>
    <div class="<%=opportunity.stage%>">
      <%= t(opportunity.stage)%>
    </div>
  <%else%>
    <div class="strip white">
      <%= t :other%>
    </div>
  <% end %>

  <ul class="tools">
    <% if can?(:update, opportunity)%>
      <li><%= link_to_edit(opportunity)%></li>
    <% end %>

    <% if shown_on_landing_page?%>
      <li><%= link_to_discard(opportunity)%></li>
    <% end %>

    <% if can?(:destroy, opportunity)%>
      <li><%= link_to_delete(opportunity)%></li>
    <% end %>

  </ul>

  <div class="indent">
    <%= link_to_if can?(:read, opportunity), opportunity.name, opportunity%>
    <% if (account = opportunity.account) && account.id %>
      <%= t :from %> <%= link_to_if can?(:read, account), account.name, account_path(account)%>
    <% end %>
    <tt>
      &ndash;
      <% user_name = opportunity.user.try(:full_name)%>
      <% if user_name%>
        <%= t(:added_by, :time_ago => timeago(opportunity.created_at), :user => h(user_name)).html_safe %>
      <% else %>
        <%= t(:added_ago, :value => timeago(opportunity.created_at)).html_safe%>
      <% end %>
    </tt>

    <dt>
      <b>
        <%= number_to_currency(opportunity.weighted_amount, :precision => 0) + " | "%>
      </b>
      <% won_or_lost = %w(won lost).include?(opportunity.stage) %>
      <% unless won_or_lost %>
        <%= number_to_currency(opportunity.amount || 0, :precision => 0)%>
        <% if opportunity.discount %>
          <%= t(:discount_number, number_to_currency(opportunity.discount, :precision => 0)) %>
        <% else %>
          <%= t(:no_discount) %>
        <% end %>
        <%= t(:probability_number, (opportunity.probability || 0).to_s + '%') + " | "%>
      <% end %>
      <% if opportunity.closes_on %>
        <% if won_or_lost %>
          <% if opportunity.closes_on >= Date.today%>
            <%= t(:closing_date, l(opportunity.closes_on, :format => :mmddyy)) %>
          <% else %>
            <%= t(:closed_ago_on, :time_ago => distance_of_time_in_words(opportunity.closes_on, Date.today), :date => l(opportunity.closes_on, :format => :mmddyy)) %>
          <% end %>
        <% elsif opportunity.closes_on > Date.today %>
          <%= t(:expected_to_close,  :time => distance_of_time_in_words(Date.today, opportunity.closes_on), :date => l(opportunity.closes_on, :format => :mmddyy)) %>
        <% elsif opportunity.closes_on == Date.today %>
          <span class="warn"><%= t(:closes_today)%></span>
        <% else %>
          <span class="warn">
            <%= t(:past_due, distance_of_time_in_words(opportunity.closes_on, Date.today))%>
          </span>
        <% end %>
      <% else %>
        <%= t(:no_closing_date) %>
      <% end %>
    </dt>
    <% if opportunity.tag_list.present? %>
      <dt>
        <div class="tags"><%= tags_for_index(opportunity)%></div>
      </dt>
    <% end %>
  </div>
  <%= hook(:opportunity_bottom, self, :opportunity => opportunity)%>
</li>